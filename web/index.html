<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Family Tree</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå≥</text></svg>">

  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <script defer src="/web/app.js"></script>

  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Fullscreen graph container */
    #graph {
      position: fixed;
      inset: 0;           /* top:0; right:0; bottom:0; left:0 */
      width: 100vw;
      height: 100vh;
    }

    /* Context menu */
    #ctxMenu {
      position: fixed;
      display: none;
      z-index: 9999;
      min-width: 220px;
      background: #111;
      color: #fff;
      border: 1px solid #333;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      padding: 8px;
      font-size: 14px;
    }

    #ctxMenu button {
      width: 100%;
      text-align: left;
      background: transparent;
      color: inherit;
      border: 0;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    #ctxMenu button:hover {
      background: rgba(255,255,255,.08);
    }

    #ctxMenu .hint {
      opacity: .7;
      font-size: 12px;
      padding: 6px 10px 2px;
    }

    #ctxMenu .sep {
      height: 1px;
      background: #2a2a2a;
      margin: 6px 0;
    }

    /* Relationship status overlay */
    #relStatus {
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 9999;
      background: #111;
      color: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      font: 12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
      max-width: 320px;
    }

    /* Unified Tree + Relationship bar */
    #treeBar {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 9999;
      background: #111;
      color: #fff;
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
      width: 300px;
      font: 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    #treeBar .section {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #treeBar .title {
      font-weight: 600;
      opacity: .95;
    }

    #treeBar .row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    #treeBar select {
      flex: 1;
      background: #0b0b0b;
      color: #fff;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 8px;
      outline: none;
    }

    #treeBar button {
      background: transparent;
      color: inherit;
      border: 1px solid #333;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    #treeBar button:hover {
      background: rgba(255,255,255,.08);
    }

    #treeBar .import-zone {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #treeBar .import-drop-area {
      border: 2px dashed #444;
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      background: rgba(255,255,255,.02);
      cursor: pointer;
      transition: all 0.2s;
    }

    #treeBar .import-drop-area:hover {
      border-color: #666;
      background: rgba(255,255,255,.05);
    }

    #treeBar .import-drop-area.drag-over {
      border-color: #4a9eff;
      background: rgba(74,158,255,.1);
    }

    #treeBar .import-icon {
      font-size: 24px;
      margin-bottom: 6px;
    }

    #treeBar .import-text {
      font-size: 12px;
      opacity: .9;
    }

    #treeBar .import-hint {
      font-size: 11px;
      opacity: .6;
      margin-top: 4px;
    }

    #treeBar .sep {
      height: 1px;
      background: #2a2a2a;
      margin: 10px 0;
    }

    #treeBar .rel-text {
      opacity: .9;
    }

    #treeBar .rel-hint {
      margin-top: 4px;
      opacity: .65;
    }

    /* MODAL STYLES */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      z-index: 10000;
    }

    .modal{
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(420px, calc(100vw - 32px));
      background: #111;
      color: #fff;
      border: 1px solid #333;
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
      padding: 14px;
      z-index: 10001;
    }

    .modal-title{
      font-weight: 700;
      margin-bottom: 10px;
    }

    .modal-label{
      display:block;
      margin: 10px 0 6px;
      opacity: .85;
      font-size: 12px;
    }

    .modal-input, .modal-textarea{
      width: 100%;
      background: #0b0b0b;
      color: #fff;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px;
      outline: none;
      font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .modal-textarea{
      min-height: 90px;
      resize: vertical;
    }

    .modal-actions{
      display:flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px;
    }

    .modal-btn{
      background: transparent;
      color: inherit;
      border: 1px solid #333;
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
    }

    .modal-btn:hover{
      background: rgba(255,255,255,.08);
    }

    .modal-btn.primary{
      border-color: #555;
    }

    /* TOOLBAR STYLES */
    #toolbar {
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 9998;
      display: flex;
      gap: 8px;
      background: #111;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #333;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
    }

    #toolbar button {
      display: flex;
      align-items: center;
      gap: 6px;
      background: transparent;
      color: #fff;
      border: 1px solid #333;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font: 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      white-space: nowrap;
      transition: all 0.2s;
    }

    #toolbar button:hover {
      background: rgba(255,255,255,.08);
      border-color: #555;
    }

    #toolbar button:active {
      background: rgba(255,255,255,.12);
    }

    #toolbar button.icon-only {
      padding: 8px 10px;
    }

    /* Toolbar icon styling */
    #toolbar button .icon {
      font-size: 14px;
      display: inline-block;
    }

    /* Search results dropdown */
    #searchResultsDropdown {
      position: fixed;
      top: 50px;
      right: 12px;
      z-index: 9998;
      background: #111;
      border: 1px solid #333;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
      max-width: 320px;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }

    #searchResultsDropdown .result-item {
      padding: 10px 12px;
      cursor: pointer;
      border-bottom: 1px solid #1a1a1a;
      color: #fff;
      font-size: 12px;
      transition: background 0.15s;
    }

    #searchResultsDropdown .result-item:hover {
      background: rgba(255,255,255,.08);
    }

    #searchResultsDropdown .result-item:last-child {
      border-bottom: none;
    }

    #searchResultsDropdown .result-name {
      font-weight: 500;
    }

    #searchResultsDropdown .result-meta {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 2px;
    }

    #searchResultsDropdown .no-results {
      padding: 12px;
      text-align: center;
      color: #999;
      font-size: 12px;
    }

    /* Pick mode indicator in toolbar */
    #toolbar .pick-mode-indicator {
      padding: 8px 12px;
      background: rgba(74, 158, 255, 0.15);
      border: 1px solid rgba(74, 158, 255, 0.4);
      border-radius: 8px;
      font-size: 12px;
      color: #4a9eff;
      display: none;
      align-items: center;
      gap: 6px;
    }

    #toolbar .pick-mode-indicator.active {
      display: flex;
    }

    /* SEARCH MODAL */
    #searchModal .modal-input {
      margin-bottom: 10px;
    }

    #searchModal .search-results {
      max-height: 300px;
      overflow-y: auto;
    }

    #searchModal .search-result-item {
      padding: 10px;
      margin-bottom: 6px;
      background: rgba(255,255,255,.02);
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.15s;
    }

    #searchModal .search-result-item:hover {
      background: rgba(255,255,255,.08);
      border-color: #333;
    }

    #searchModal .search-result-name {
      font-weight: 500;
      margin-bottom: 2px;
    }

    #searchModal .search-result-meta {
      font-size: 11px;
      opacity: 0.7;
    }
        
  </style>
</head>

<body>

  <!-- FULLSCREEN PLOTLY TARGET -->
  <div id="graph"></div>

  <!-- TREE + STATUS BAR -->
  <div id="treeBar">
    <div class="section">
      <div class="title">Family tree</div>

      <div class="row">
        <select id="treeSelect"></select>
        <button id="treeNewBtn" title="Create new tree">Ôºã</button>
      </div>

      <div class="row">
        <input id="treeNameInput" class="modal-input" placeholder="Tree name" />
      </div>

      <div class="row">
        <select id="treeVersionsSelect"></select>
        <button id="treeLoadVersionBtn">Load</button>
      </div>

      <div class="row">
        <button id="treeSaveBtn">Save</button>
        <button id="treeDiscardBtn">Discard</button>
      </div>

      <div class="import-zone">
        <input id="fileImportInput" type="file" accept=".txt,.csv,.json" style="display:none;" />
        <div id="importDropArea" class="import-drop-area" title="Click to browse or drag & drop a file">
          <div class="import-icon">üìÅ</div>
          <div class="import-text">Click or drag file to import</div>
          <div class="import-hint">Supports: .txt, .csv, .json</div>
        </div>
      </div>
    </div>

    <div class="sep"></div>

    <div class="section">
      <div class="title">Relationship mode</div>

      <div id="relStatusText" class="rel-text">
        Right-click a person to begin.
      </div>

      <div class="rel-hint">
        Tip: Press <b>Esc</b> to clear
      </div>
    </div>
  </div>

  <!-- TOOLBAR -->
  <div id="toolbar">
    <button id="btnAddPerson" title="Add a new person (Ctrl+N)">
      <span class="icon">‚ûï</span>
      <span>Add Person</span>
    </button>
    <button id="btnAddRelationship" title="Create a relationship (Ctrl+R)">
      <span class="icon">üîó</span>
      <span>Relationship</span>
    </button>
    <button id="btnSearch" title="Search people (Ctrl+F)">
      <span class="icon">üîç</span>
      <span>Search</span>
    </button>
    <button id="btnHelp" class="icon-only" title="Help & shortcuts">
      <span class="icon">‚ùì</span>
    </button>
    <div class="pick-mode-indicator" id="pickModeIndicator">
      <span id="pickModeText">Picking...</span>
      <button style="padding:0;border:0;background:transparent;color:inherit;cursor:pointer;" onclick="clearAllPickModes()">‚úï</button>
    </div>
  </div>

  <!-- SEARCH RESULTS DROPDOWN -->
  <div id="searchResultsDropdown">
    <div id="searchResultsList"></div>
  </div>

  <!-- CONTEXT MENU -->
  <div id="ctxMenu">
    <div class="hint" id="ctxHint">Right-click menu</div>
    <button id="ctxEditPerson">‚úèÔ∏è Edit Person‚Ä¶</button>
    <button id="ctxAddChildOf">üîó Add CHILD_OF relationship‚Ä¶</button>
    <button id="ctxAddParentOf">üîó Add PARENT_OF relationship‚Ä¶</button>
    <button id="ctxAddSpouseOf">üíï Add SPOUSE_OF relationship‚Ä¶</button>
    <button id="ctxDeletePerson">üóëÔ∏è Delete Person</button>
    <button id="ctxDeleteRelationship">üóëÔ∏è Delete Relationship</button>
    <button id="ctxAddPerson">‚ûï Add Person‚Ä¶</button>
  </div>

  <!-- EDIT PERSON MODAL -->
  <div id="personModalBackdrop" class="modal-backdrop" style="display:none;"></div>

  <div id="personModal" class="modal" style="display:none;">
    <div class="modal-title" id="personModalTitle">Edit Person</div>

    <label class="modal-label">Name</label>
    <input id="personNameInput" class="modal-input" placeholder="Full name" />

    <label class="modal-label">Notes (optional)</label>
    <textarea id="personNotesInput" class="modal-textarea" placeholder="Anything helpful‚Ä¶"></textarea>

    <label class="modal-label">Change parent</label>
    <div style="display:flex;gap:8px;align-items:center;">
      <select id="personParentSelect" class="modal-input" style="flex:1"></select>
      <button id="personParentSave" class="modal-btn">Set Parent</button>
    </div>

    <div class="modal-actions">
      <button id="personModalCancel" class="modal-btn">Cancel</button>
      <button id="personModalSave" class="modal-btn primary">Save</button>
    </div>
  </div>

  <!-- SEARCH MODAL -->
  <div id="searchModalBackdrop" class="modal-backdrop" style="display:none;"></div>

  <div id="searchModal" class="modal" style="display:none;">
    <div class="modal-title">Search People</div>
    <input id="searchInput" class="modal-input" placeholder="Enter name to search..." autofocus />
    <div class="search-results" id="searchResultsContainer"></div>
    <div class="modal-actions">
      <button id="searchModalClose" class="modal-btn">Close</button>
    </div>
  </div>

</body>
</html>
